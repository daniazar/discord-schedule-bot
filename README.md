# Discord Schedule Bot

A Vercel-ready Discord bot (Next.js API route) for managing channel-specific signup lists by time, using Supabase for storage.

## Features

- **Discord Slash Commands**:  
  - `/add time:2025-07-06T19:00:00Z` — Add yourself to a time slot
  - `/remove` — Remove yourself from all future signups for this channel
  - `/list` — Show the current and next signups
  - `/next` — Tag the user whose time is closest to now
  - `/settitle title:My List Title` — Change the channel list title
  - `/config title:My List Title` — Create a new list for this channel (sets title and clears all signups)
  - `/clear` — Delete all signups and title for this channel

- **Web Dashboard** (`/dashboard`):  
  - View all channel lists and signups
  - Add/remove signups
  - Edit/delete lists
  - All changes sync with Discord bot and Supabase live

- **Channel-specific lists and titles**
- On first use in a channel, creates a new list with the channel name as the title automatically.
- Prevents double-booking for the same time
- Cleans up past signups on `/list`
- Ready for Vercel deployment

## Supabase Schema

```sql
-- signups table
create table signups (
  id bigint generated by default as identity primary key,
  guild_id text,
  channel_id text not null,
  user_id text not null,
  username text not null,
  time timestamptz not null,
  inserted_at timestamptz not null default now(),
  unique (channel_id, time)
);

-- titles table
create table titles (
  id bigint generated by default as identity primary key,
  channel_id text not null unique,
  title text not null
);
```

## Setup

1. **Create a Discord App and Bot**

   - Get your `DISCORD_PUBLIC_KEY`, `DISCORD_APPLICATION_ID`, and `DISCORD_BOT_TOKEN`.

2. **Deploy Supabase**

   - Create a project at [supabase.com](https://supabase.com).
   - Create the tables as shown above.
   - Get your `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY`, and `SUPABASE_ANON_KEY`.

3. **Configure Environment Variables**

   - Copy `.env.example` to `.env.local` and fill in the values.

4. **Deploy on Vercel**

   - Push to GitHub and import to [Vercel](https://vercel.com).
   - Set all env variables in your Vercel project.

5. **Register Discord Slash Commands**

   - Run `npm run register-commands` once locally.

6. **Set Discord Interaction Endpoint**

   - In the Discord Developer Portal, set your interaction endpoint to:
     ```
     https://YOUR-VERCEL-DEPLOYMENT.vercel.app/api/discord
     ```

7. **Invite the Bot to your Server**

   - Go to “OAuth2” > “URL Generator” in the Discord Developer Portal.
   - Select `bot` and `applications.commands` scopes.
   - Under Bot Permissions, select `Send Messages`, `Read Message History`.
   - Paste the generated link in your browser, select your server, and authorize.

8. **Access the Dashboard**

   - Go to `/dashboard` on your deployment to view and manage all lists and signups.

## Usage

- `/add time:2025-07-06T19:00:00Z`
- `/remove`
- `/list`
- `/next`
- `/settitle title:My List Title`
- `/config title:My New List`
- `/clear`